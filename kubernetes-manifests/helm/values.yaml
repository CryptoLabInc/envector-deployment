# es2-chart/values.yaml

# Global settings can be defined here
# username is used to mimic the ${USER_NAME} variable from docker-compose

# Overrides for chart name and fullname
nameOverride: ""
fullnameOverride: ""

# External services that this chart depends on.
# These should be running separately.
externalServices:
  metadatadb:
    url: "user=<metadatadb_user> password=<metadatadb_password> host=<metadatadb_host> port=<metadatadb_port> dbname=<metadatadb_database> sslmode=require options='-c search_path=public'"
    schema: "public"
  storage:
    host: <storage_host>
    port: <storage_port>
    user: <storage_user>
    password: <storage_password>
    secure: true
    region: <storage_region>
    create: false
    bucket_name: <storage_bucket>
    hasHealthcheckEndpoint: false # Only for Minio.

imagePullSecrets: []

# Global labels applied to all components
labels: {}

# Configuration for es2e service
es2e:
  name: es2e
  labels: {}
  image:
    repository: cryptolabinc/es2e
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 50050
    # type: LoadBalancer # Enable this for direct external access without ingress
    # nodePort: 30050 # Optionally specify a nodePort when using NodePort type
    # Optional pod annotations for es2e deployment
    annotations: {}
  logLevel: INFO
  resources: {}
    # limits:
    #   cpu: "1"
    #   memory: "2Gi"
    # requests:
    #   cpu: "0.5"
    #   memory: "1Gi"
  nodeSelector: {}
  affinity: {}
  tolerations: []

# Configuration for es2b service
es2b:
  name: es2b
  labels: {}
  image:
    repository: cryptolabinc/es2b
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 50051
  logLevel: INFO
  env:
    shardSize: 4096
  resources: {}
    # limits:
    #   cpu: "1"
    #   memory: "2Gi"
    # requests:
    #   cpu: "0.5"
    #   memory: "1Gi"
  nodeSelector: {}
  affinity: {}
  tolerations: []

# Configuration for es2o service
es2o:
  name: es2o
  labels: {}
  image:
    repository: cryptolabinc/es2o
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 25121
    headlessSuffix: "-headless"
  command: []
  logLevel: INFO
  replicas: 1
  election:
    lockID: "808707" # this value will be hashed internally
  resources: {}
    # limits:
    #   cpu: "1"
    #   memory: "2Gi"
    # requests:
    #   cpu: "0.5"
    #   memory: "1Gi"
  nodeSelector: {}
  affinity: {}
  tolerations: []

# Configuration for es2c service
es2c:
  name: es2c
  labels: {}
  variant: cpu
  image:
    repository: cryptolabinc/es2c
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 25123
  command: []
  replicas: 2
  env:
    useTopk: false
    host: "0.0.0.0"
    threadPoolScale: 4
    numSearchHandler: 10
  license:
    enabled: true
    tokenPath: "/es2/license/token.jwt"
    createSecret: true
    token: ""
    # Use this to reference an existing Secret instead of creating one
    existingSecret: ""
    secret:
      name: ""
      key: "token.jwt"
      # Optional: set a checksum string to force rollout when using existingSecret
      checksum: ""
  resources:
    cpu:
      limits:
        cpu: "4"
      requests:
        cpu: "2"
        memory: "2Gi"
    gpu:
      limits:
        nvidia.com/gpu: 1
        cpu: "8"
      requests:
        cpu: "4"
        memory: "4Gi"
  nodeSelector: {}
  affinity: {}
  tolerations: []

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: es2.local
      paths:
        - path: /
          pathType: Prefix
          service:
            name: es2e
            port: 50050
  tls: []
    # - secretName: es2-tls
    #   hosts:
    #     - es2.local

# External Secrets Operator (ESO) integration
# Each secret can be enabled independently
externalSecrets:
  # Reference to the SecretStore/ClusterSecretStore managed by ESO
  secretStoreRef:
    kind: ClusterSecretStore
    name: ""
  # ExternalSecret for DB connection URL
  dbSecret:
    enabled: false
    # Optional: override the target Secret name created by ESO
    # Defaults to "<release>-<chart>-db-eso" when empty
    name: ""
    refreshInterval: 1m
    data: []
      # Example:
      # - secretKey: ES2_DB_SERVICE_URL
      #   remoteRef:
      #     key: "prod/app/db"      # remote secret name/path (e.g., AWS SM, Vault, etc.)
      #     property: "db_url"       # optional: key/property within the remote secret
  # ExternalSecret for storage credentials
  storageSecret:
    enabled: false
    # Optional: override the target Secret name created by ESO
    # Defaults to "<release>-<chart>-storage-eso" when empty
    name: ""
    refreshInterval: 1m
    data: []
      # Examples:
      # - secretKey: ES2_STORAGE_SERVICE_USER
      #   remoteRef:
      #     key: "prod/minio"
      #     property: "accessKey"
      # - secretKey: ES2_STORAGE_SERVICE_PASSWORD
      #   remoteRef:
      #     key: "prod/minio"
      #     property: "secretKey"
  # ExternalSecret for license token
  license:
    enabled: true
    # Optional: override the target Secret name created by ESO
    # Defaults to the same Secret name used by es2c ("<fullname>-es2c-license")
    name: ""
    refreshInterval: 1m
    # Key inside the target Secret where the token will be stored
    secretKey: "token.jwt"
    remoteRef:
      key: ""        # remote secret name/path containing the license token
      property: ""   # optional: key/property within the remote secret

# Standard Kubernetes Secret integration
# Each secret can be configured independently
# If set, uses existing Secret instead of creating one or using ExternalSecret
existingSecrets:
  # Existing Secret for DB connection URL
  # Defaults to "<release>-<chart>-db-secret" when empty
  # If empty and externalSecrets.dbSecret.enabled=false, creates default Secret
  dbSecret: ""
  # Existing Secret for storage credentials
  # Defaults to "<release>-<chart>-storage-secret" when empty
  # If empty and externalSecrets.storageSecret.enabled=false, creates default Secret
  storageSecret: ""
